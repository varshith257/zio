"use strict";(self.webpackChunkzio_site=self.webpackChunkzio_site||[]).push([[80212],{15680:(e,n,t)=>{t.d(n,{xA:()=>s,yg:()=>m});var o=t(96540);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,a=function(e,n){if(null==e)return{};var t,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var g=o.createContext({}),p=function(e){var n=o.useContext(g),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},s=function(e){var n=p(e.components);return o.createElement(g.Provider,{value:n},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},u=o.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,g=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),c=p(t),u=a,m=c["".concat(g,".").concat(u)]||c[u]||d[u]||i;return t?o.createElement(m,r(r({ref:n},s),{},{components:t})):o.createElement(m,r({ref:n},s))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,r=new Array(i);r[0]=u;var l={};for(var g in n)hasOwnProperty.call(n,g)&&(l[g]=n[g]);l.originalType=e,l[c]="string"==typeof e?e:a,r[1]=l;for(var p=2;p<i;p++)r[p]=t[p];return o.createElement.apply(null,r)}return o.createElement.apply(null,t)}u.displayName="MDXCreateElement"},70871:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>g,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var o=t(58168),a=(t(96540),t(15680));const i={id:"create-custom-logger-for-a-zio-application",title:"Tutorial: How to Create a Custom Logger for a ZIO Application?",sidebar_label:"Create Custom Logger for a ZIO Application"},r=void 0,l={unversionedId:"guides/tutorials/create-custom-logger-for-a-zio-application",id:"guides/tutorials/create-custom-logger-for-a-zio-application",title:"Tutorial: How to Create a Custom Logger for a ZIO Application?",description:"Introduction",source:"@site/docs/guides/tutorials/create-custom-logger-for-a-zio-application.md",sourceDirName:"guides/tutorials",slug:"/guides/tutorials/create-custom-logger-for-a-zio-application",permalink:"/guides/tutorials/create-custom-logger-for-a-zio-application",draft:!1,editUrl:"https://github.com/zio/zio/edit/series/2.x/docs/guides/tutorials/create-custom-logger-for-a-zio-application.md",tags:[],version:"current",frontMatter:{id:"create-custom-logger-for-a-zio-application",title:"Tutorial: How to Create a Custom Logger for a ZIO Application?",sidebar_label:"Create Custom Logger for a ZIO Application"},sidebar:"guides-sidebar",previous:{title:"Enable Logging in a ZIO Application",permalink:"/guides/tutorials/enable-logging-in-a-zio-application"},next:{title:"Running Our First ZIO Project With VSCode",permalink:"/guides/tutorials/run-our-first-zio-project-with-vscode"}},g={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Running the Examples",id:"running-the-examples",level:2},{value:"Creating a Custom Logger",id:"creating-a-custom-logger",level:2},{value:"Using SLF4J Logger in a ZIO Application",id:"using-slf4j-logger-in-a-zio-application",level:2},{value:"Adding a Simple SLF4J Binding to the Classpath",id:"adding-a-simple-slf4j-binding-to-the-classpath",level:2},{value:"Switching to the Reload4j Logging Framework",id:"switching-to-the-reload4j-logging-framework",level:2},{value:"Switching to the Logback Logging Framework",id:"switching-to-the-logback-logging-framework",level:2},{value:"Conclusion",id:"conclusion",level:2}],s={toc:p},c="wrapper";function d(e){let{components:n,...t}=e;return(0,a.yg)(c,(0,o.A)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,a.yg)("h2",{id:"introduction"},"Introduction"),(0,a.yg)("p",null,"As we have seen in the ",(0,a.yg)("a",{parentName:"p",href:"/guides/tutorials/enable-logging-in-a-zio-application"},"previous tutorial"),", ZIO has a variety of built-in logging facilities. Also, it has a default logger that can be used to print log messages to the console. When we go to production, we may want to use a different logger with a customized configuration. For example, we may want to log to a file or a database instead of the console."),(0,a.yg)("p",null,"In this tutorial, we are going to see how we can create a custom logger for a ZIO application."),(0,a.yg)("h2",{id:"running-the-examples"},"Running the Examples"),(0,a.yg)("p",null,"In ",(0,a.yg)("a",{parentName:"p",href:"/guides/tutorials/enable-logging-in-a-zio-application"},"this article"),", we enabled logging for ",(0,a.yg)("inlineCode",{parentName:"p"},"UserApp")," http application. In this tutorial, we are going to create a custom logger for the ",(0,a.yg)("inlineCode",{parentName:"p"},"UserApp"),"."),(0,a.yg)("p",null,"To run the code, clone the repository and checkout the ",(0,a.yg)("a",{parentName:"p",href:"http://github.com/zio/zio-quickstarts"},"ZIO Quickstarts")," project:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},"$ git clone https://github.com/zio/zio-quickstarts.git\n$ cd zio-quickstarts/zio-quickstart-restful-webservice-custom-logger\n")),(0,a.yg)("p",null,"And finally, run the application using sbt:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},"$ sbt run\n")),(0,a.yg)("p",null,"Alternatively, to enable hot-reloading and prevent port binding issues, you can use:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},"sbt reStart\n")),(0,a.yg)("admonition",{type:"note"},(0,a.yg)("p",{parentName:"admonition"},'If you encounter a "port already in use" error, you can use ',(0,a.yg)("inlineCode",{parentName:"p"},"sbt-revolver")," to manage server restarts more effectively. The ",(0,a.yg)("inlineCode",{parentName:"p"},"reStart")," command will start your server and ",(0,a.yg)("inlineCode",{parentName:"p"},"reStop")," will properly stop it, releasing the port."),(0,a.yg)("p",{parentName:"admonition"},"To enable this feature, we have included ",(0,a.yg)("inlineCode",{parentName:"p"},"sbt-revolver")," in the project. For more details on this, refer to the ",(0,a.yg)("a",{parentName:"p",href:"https://zio.dev/zio-http/installation#hot-reload-changes-watch-mode"},"ZIO HTTP documentation on hot-reloading"),".")),(0,a.yg)("h2",{id:"creating-a-custom-logger"},"Creating a Custom Logger"),(0,a.yg)("p",null,"To create a new logger for the ZIO application, we need to create a new ",(0,a.yg)("inlineCode",{parentName:"p"},"ZLogger")," object. The ",(0,a.yg)("inlineCode",{parentName:"p"},"ZLogger")," is a trait that defines the interface for a ZIO logger. The default logger has implemented this trait through the ",(0,a.yg)("inlineCode",{parentName:"p"},"ZLogger.default")," object."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-scala"},'import zio._\n\nval logger: ZLogger[String, Unit] =\n  new ZLogger[String, Unit] {\n    override def apply(\n      trace: Trace,\n      fiberId: FiberId,\n      logLevel: LogLevel,\n      message: () => String,\n      cause: Cause[Any],\n      context: FiberRefs,\n      spans: List[LogSpan],\n      annotations: Map[String, String]\n    ): Unit =\n      println(s"${java.time.Instant.now()} - ${logLevel.label} - ${message()}")\n  }\n')),(0,a.yg)("p",null,"So then, we can remove all the default loggers and replace them with our custom logger:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-scala"},'import zio._\n\nobject MainApp extends ZIOAppDefault {\n\n  val logger: ZLogger[String, Unit] =\n    new ZLogger[String, Unit] {\n      override def apply(\n        trace: Trace,\n        fiberId: FiberId,\n        logLevel: LogLevel,\n        message: () => String,\n        cause: Cause[Any],\n        context: FiberRefs,\n        spans: List[LogSpan],\n        annotations: Map[String, String]\n      ): Unit =\n        println(s"${java.time.Instant.now()} - ${logLevel.label} - ${message()}")\n    }\n\n  override val bootstrap = Runtime.removeDefaultLoggers ++ Runtime.addLogger(logger)\n\n  def run =\n    for {\n      _ <- ZIO.log("Application started!")\n      _ <- ZIO.log("Another log message.")\n      _ <- ZIO.log("Application stopped!")\n    } yield ()\n}\n')),(0,a.yg)("p",null,"By running this application, the log messages will be printed like this:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},"2022-06-04T13:49:19.554648Z - INFO - Application started!\n2022-06-04T13:49:19.567854Z - INFO - Another log message.\n2022-06-04T13:49:19.568831Z - INFO - Application stopped!\n")),(0,a.yg)("h2",{id:"using-slf4j-logger-in-a-zio-application"},"Using SLF4J Logger in a ZIO Application"),(0,a.yg)("p",null,"So far, we learned how to write a custom logger for a ZIO application. Now, in this section, we want to add SLF4J Logging support to the ",(0,a.yg)("inlineCode",{parentName:"p"},"UserApp")," we have developed in the ",(0,a.yg)("a",{parentName:"p",href:"/guides/quickstarts/restful-webservice"},"Restful Web Service")," quickstart."),(0,a.yg)("p",null,"SLF4J is a logging facade that decouples our application code from any underlying logging implementation. To enable SLF4J logging for a ZIO application, we need to implement the ",(0,a.yg)("inlineCode",{parentName:"p"},"ZLogger")," trait using SLF4J. Fortunately, the ZIO Logging project has done this for us."),(0,a.yg)("p",null,"So we can simply add this library to our project by adding the following dependencies to our ",(0,a.yg)("inlineCode",{parentName:"p"},"build.sbt")," file:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-scala"},'libraryDependencies += "dev.zio" %% "zio-logging"       % "2.0.0"\nlibraryDependencies += "dev.zio" %% "zio-logging-slf4j" % "2.0.0"\n')),(0,a.yg)("p",null,"Now we can use the ",(0,a.yg)("inlineCode",{parentName:"p"},"SLF4J.sl4j")," layer to enable SLF4J logging:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-scala"},'import zio._\nimport zio.logging.LogFormat\nimport zio.logging.backend.SLF4J\n\nobject MainApp extends ZIOAppDefault {\n  override val bootstrap = SLF4J.slf4j(LogFormat.colored)\n\n  def run = ZIO.log("Application started!")\n}\n')),(0,a.yg)("p",null,"Let's run the application and see the output:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},'SLF4J: Failed to load class "org.slf4j.impl.StaticLoggerBinder".\nSLF4J: Defaulting to no-operation (NOP) logger implementation\nSLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.\n')),(0,a.yg)("p",null,"Oops! The SLF4J failed to find any binding in the classpath. To fix this, we need to add an SLF4J binding to our classpath."),(0,a.yg)("h2",{id:"adding-a-simple-slf4j-binding-to-the-classpath"},"Adding a Simple SLF4J Binding to the Classpath"),(0,a.yg)("p",null,"The SLF4J has a simple binding that can be used by adding the ",(0,a.yg)("inlineCode",{parentName:"p"},"slf4j-simple")," dependency to our ",(0,a.yg)("inlineCode",{parentName:"p"},"build.sbt")," file:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-scala"},'libraryDependencies += "org.slf4j" % "slf4j-simple" % "1.7.36"\n')),(0,a.yg)("p",null,"And then we can run the application again:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},'[ZScheduler-Worker-7] INFO zio-slf4j-logger - timestamp=2022-06-04T19:36:43.768256+04:30 level=INFO thread=zio-fiber-6 message="Application started!"\n')),(0,a.yg)("p",null,"It works! Now, our ZIO application uses SLF4J for its logging backend."),(0,a.yg)("p",null,"Similarly, we can bind our application to any other logging framework by adding the appropriate dependency to our ",(0,a.yg)("inlineCode",{parentName:"p"},"build.sbt")," file:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"slf4j-log4j12")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"slf4j-reload4j")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"slf4j-jdk14")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"slf4j-nop")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"slf4j-jcl")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"logback-classic"))),(0,a.yg)("p",null,"To switch to another logging framework, we need to provide one of the above dependencies instead of ",(0,a.yg)("inlineCode",{parentName:"p"},"slf4j-simple"),". In the next section, we will learn how to switch to the ",(0,a.yg)("inlineCode",{parentName:"p"},"reload4j")," logging framework."),(0,a.yg)("h2",{id:"switching-to-the-reload4j-logging-framework"},"Switching to the Reload4j Logging Framework"),(0,a.yg)("p",null,"To use the ",(0,a.yg)("inlineCode",{parentName:"p"},"reload4j")," logging framework, we need to add the following dependencies to our ",(0,a.yg)("inlineCode",{parentName:"p"},"build.sbt")," file:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-diff"},'- libraryDependencies += "org.slf4j" % "slf4j-simple" % "1.7.36"\n+ libraryDependencies += "org.slf4j" % "slf4j-reload4j" % "1.7.36"\n')),(0,a.yg)("p",null,"Now we can configure our logger by adding the ",(0,a.yg)("inlineCode",{parentName:"p"},"log4j.properties")," to the resources directory:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"log4j.rootLogger = Info, consoleAppender\nlog4j.appender.consoleAppender=org.apache.log4j.ConsoleAppender\nlog4j.appender.consoleAppender.layout=org.apache.log4j.PatternLayout\nlog4j.appender.consoleAppender.layout.ConversionPattern=[%p] %d %c %M - %m%n\n")),(0,a.yg)("p",null,"By customizing the ",(0,a.yg)("inlineCode",{parentName:"p"},"ConversionPattern")," we can control the format of the log messages."),(0,a.yg)("h2",{id:"switching-to-the-logback-logging-framework"},"Switching to the Logback Logging Framework"),(0,a.yg)("p",null,"In the same way, we can switch to the ",(0,a.yg)("inlineCode",{parentName:"p"},"logback-classic")," logging framework by adding the following dependencies to our ",(0,a.yg)("inlineCode",{parentName:"p"},"build.sbt")," file:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-diff"},'- libraryDependencies += "org.slf4j"      % "slf4j-reload4j"  % "1.7.36"\n+ libraryDependencies += "ch.qos.logback" % "logback-classic" % "1.2.11"\n')),(0,a.yg)("p",null,"Then we can configure our logger by adding the ",(0,a.yg)("inlineCode",{parentName:"p"},"logback.xml")," to the resources directory:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-xml"},'<?xml version="1.0" encoding="UTF-8"?>\n\n<configuration>\n    <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">\n        <encoder>\n            <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>\n        </encoder>\n    </appender>\n    <root level="info">\n        <appender-ref ref="STDOUT"/>\n    </root>\n</configuration>\n')),(0,a.yg)("h2",{id:"conclusion"},"Conclusion"),(0,a.yg)("p",null,"In this article, we have learned how to create a custom logger for a ZIO application. We also covered how to add SLF4J logging support instead of default ZIO logging."),(0,a.yg)("p",null,"All the source code associated with this article is available on the ",(0,a.yg)("a",{parentName:"p",href:"http://github.com/zio/zio-quickstarts"},"ZIO Quickstart")," project."))}d.isMDXComponent=!0}}]);