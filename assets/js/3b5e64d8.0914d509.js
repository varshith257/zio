"use strict";(self.webpackChunkzio_site=self.webpackChunkzio_site||[]).push([[60200],{15680:(e,a,n)=>{n.d(a,{xA:()=>c,yg:()=>u});var i=n(96540);function t(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function r(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);a&&(i=i.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?r(Object(n),!0).forEach((function(a){t(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function s(e,a){if(null==e)return{};var n,i,t=function(e,a){if(null==e)return{};var n,i,t={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],a.indexOf(n)>=0||(t[n]=e[n]);return t}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(t[n]=e[n])}return t}var l=i.createContext({}),p=function(e){var a=i.useContext(l),n=a;return e&&(n="function"==typeof e?e(a):o(o({},a),e)),n},c=function(e){var a=p(e.components);return i.createElement(l.Provider,{value:a},e.children)},g="mdxType",m={inlineCode:"code",wrapper:function(e){var a=e.children;return i.createElement(i.Fragment,{},a)}},d=i.forwardRef((function(e,a){var n=e.components,t=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),g=p(n),d=t,u=g["".concat(l,".").concat(d)]||g[d]||m[d]||r;return n?i.createElement(u,o(o({ref:a},c),{},{components:n})):i.createElement(u,o({ref:a},c))}));function u(e,a){var n=arguments,t=a&&a.mdxType;if("string"==typeof e||t){var r=n.length,o=new Array(r);o[0]=d;var s={};for(var l in a)hasOwnProperty.call(a,l)&&(s[l]=a[l]);s.originalType=e,s[g]="string"==typeof e?e:t,o[1]=s;for(var p=2;p<r;p++)o[p]=n[p];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},56632:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var i=n(58168),t=(n(96540),n(15680));const r={id:"migration-guide",title:"Migration guide"},o="Migration from v3.x.x.x",s={unversionedId:"zio-aws/migration-guide",id:"zio-aws/migration-guide",title:"Migration guide",description:"There are some major changes compared to the ZIO 1 version (v3.x.x.x and v4.x.x.x). This section contains detailed information about what changed and how to modify existing code.",source:"@site/docs/zio-aws/migration_guide.md",sourceDirName:"zio-aws",slug:"/zio-aws/migration-guide",permalink:"/zio-aws/migration-guide",draft:!1,editUrl:"https://github.com/zio/zio/edit/series/2.x/docs/zio-aws/migration_guide.md",tags:[],version:"current",frontMatter:{id:"migration-guide",title:"Migration guide"},sidebar:"ecosystem-sidebar",previous:{title:"Changelog",permalink:"/zio-aws/changelog"},next:{title:"ZIO Actors",permalink:"/zio-actors/"}},l={},p=[{value:"New package names",id:"new-package-names",level:2},{value:"New getter names",id:"new-getter-names",level:2},{value:"New service pattern",id:"new-service-pattern",level:2},{value:"Optional parameters",id:"optional-parameters",level:2},{value:"Newtypes",id:"newtypes",level:2},{value:"Aspects",id:"aspects",level:2},{value:"New built-in aspects",id:"new-built-in-aspects",level:3},{value:"Changes in defining aspects",id:"changes-in-defining-aspects",level:3},{value:"New config library",id:"new-config-library",level:2}],c={toc:p},g="wrapper";function m(e){let{components:a,...n}=e;return(0,t.yg)(g,(0,i.A)({},c,n,{components:a,mdxType:"MDXLayout"}),(0,t.yg)("h1",{id:"migration-from-v3xxx"},"Migration from v3.x.x.x"),(0,t.yg)("p",null,"There are some major changes compared to the ZIO 1 version (v3.x.x.x and v4.x.x.x). This section contains detailed information about what changed and how to modify existing code."),(0,t.yg)("h2",{id:"new-package-names"},"New package names"),(0,t.yg)("p",null,"Previously the zio-aws packages had the root package ",(0,t.yg)("inlineCode",{parentName:"p"},"io.github.vigoo.zioaws"),". By moving to the ZIO organisation this changed to be simply ",(0,t.yg)("inlineCode",{parentName:"p"},"zio.aws"),". "),(0,t.yg)("p",null,"So imports for something using the EC2 and ElasticBeanstalk APIs would change from:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},"import io.github.vigoo.zioaws.core._\nimport io.github.vigoo.zioaws.ec2.Ec2\nimport io.github.vigoo.zioaws.ec2.model._\nimport io.github.vigoo.zioaws.elasticbeanstalk.ElasticBeanstalk\nimport io.github.vigoo.zioaws.elasticbeanstalk.model._\n")),(0,t.yg)("p",null,"to "),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},"import zio.aws.core._\nimport zio.aws.ec2.Ec2\nimport zio.aws.ec2.model._\nimport zio.aws.ec2.model.primitives._\nimport zio.aws.elasticbeanstalk.ElasticBeanstalk\nimport zio.aws.elasticbeanstalk.model._\nimport zio.aws.elasticbeanstalk.model.primitives._\n")),(0,t.yg)("p",null,"Some other changes to the imports may be necessary because of switching to the new service pattern of ZIO, described below."),(0,t.yg)("h2",{id:"new-getter-names"},"New getter names"),(0,t.yg)("p",null,"In previous version of zio-aws the generated models provided to ways to access fields:"),(0,t.yg)("ul",null,(0,t.yg)("li",{parentName:"ul"},"a ZIO effect that failed if the value is ",(0,t.yg)("inlineCode",{parentName:"li"},"None")," with the name of the field (for example ",(0,t.yg)("inlineCode",{parentName:"li"},".instanceId"),")"),(0,t.yg)("li",{parentName:"ul"},"a simple value accessor returning an ",(0,t.yg)("inlineCode",{parentName:"li"},"Option")," value with the ",(0,t.yg)("inlineCode",{parentName:"li"},"Value")," suffix (for example ",(0,t.yg)("inlineCode",{parentName:"li"},".instanceIdValue"),")")),(0,t.yg)("p",null,"This has been changed to match the convention used in ",(0,t.yg)("inlineCode",{parentName:"p"},"zio-k8s")," to the following:"),(0,t.yg)("ul",null,(0,t.yg)("li",{parentName:"ul"},"the ZIO effect for requiring that a field has value now has the ",(0,t.yg)("inlineCode",{parentName:"li"},"get")," prefix (for example ",(0,t.yg)("inlineCode",{parentName:"li"},".getInstanceId"),")"),(0,t.yg)("li",{parentName:"ul"},"the value with the field name is the simple accessor returning the optional value: (for example ",(0,t.yg)("inlineCode",{parentName:"li"},".instanceId"),")")),(0,t.yg)("p",null,"So for example the following code that prints information about EC2 instances:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},'for {\n    id <- instance.instanceId\n    typ <- instance.instanceType\n    launchTime <- instance.launchTime\n    _ <- console.putStrLn(s"  instance $id:").ignore\n    _ <- console.putStrLn(s"    type: $typ").ignore\n    _ <- console.putStrLn(s"    launched at: $launchTime").ignore\n} yield ()\n')),(0,t.yg)("p",null,"would have to be changed to:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},'for {\n    id <- instance.getInstanceId\n    typ <- instance.getInstanceType\n    launchTime <- instance.getLaunchTime\n    _ <- Console.printLine(s"  instance $id:").ignore\n    _ <- Console.printLine(s"    type: $typ").ignore\n    _ <- Console.printLine(s"    launched at: $launchTime").ignore\n} yield ()\n')),(0,t.yg)("h2",{id:"new-service-pattern"},"New service pattern"),(0,t.yg)("p",null,"Previous versions were following the ",(0,t.yg)("em",{parentName:"p"},"ZIO module pattern 1.0"),", so all the generated AWS services consisted of a type alias using ",(0,t.yg)("inlineCode",{parentName:"p"},"Has"),", a trait called ",(0,t.yg)("inlineCode",{parentName:"p"},"Service")," and a package object with the service's name. With ZIO 2 we no longer have ",(0,t.yg)("inlineCode",{parentName:"p"},"Has")," and the recommended way to structure services was changed to the simple new service pattern, where each service is just a ",(0,t.yg)("inlineCode",{parentName:"p"},"trait")," and one or more implementation classes, constructed by layers."),(0,t.yg)("p",null,"In practice this means that:"),(0,t.yg)("ul",null,(0,t.yg)("li",{parentName:"ul"},"instead of the package object with lower-case name, the accessor functions are now in the service companion object (",(0,t.yg)("inlineCode",{parentName:"li"},"ElasticBeanstalk.describeApplications")," instead of ",(0,t.yg)("inlineCode",{parentName:"li"},"elasticbeanstalk.describeApplications"),")"),(0,t.yg)("li",{parentName:"ul"},"same for the layers, for example ",(0,t.yg)("inlineCode",{parentName:"li"},"Ec2.live")," instead of ",(0,t.yg)("inlineCode",{parentName:"li"},"ec2.live")),(0,t.yg)("li",{parentName:"ul"},"the service trait has the name of the service (for example ",(0,t.yg)("inlineCode",{parentName:"li"},"Ec2"),") instead of ",(0,t.yg)("inlineCode",{parentName:"li"},"Service")," ")),(0,t.yg)("p",null,"The new service pattern is also applied to the core services like ",(0,t.yg)("inlineCode",{parentName:"p"},"AwsConfig")," and the http implementations."),(0,t.yg)("h2",{id:"optional-parameters"},"Optional parameters"),(0,t.yg)("p",null,"A very large part of the fields of AWS models are optional. These previously had the type ",(0,t.yg)("inlineCode",{parentName:"p"},"Option"),", and although for extracting data from them the library already had the generated getters, constructing these data types still required wrapping most of the parameters in ",(0,t.yg)("inlineCode",{parentName:"p"},"Some(...)"),". To reduce this boilerplate zio-aws now uses the ",(0,t.yg)("inlineCode",{parentName:"p"},"Optional")," type instead of ",(0,t.yg)("inlineCode",{parentName:"p"},"Option"),", which was first used in ",(0,t.yg)("a",{parentName:"p",href:"https://coralogix.github.io/zio-k8s/docs/overview/overview_resources#model"},"zio-k8s"),". Now the two libraries share the same type which was moved to ",(0,t.yg)("a",{parentName:"p",href:"https://zio.github.io/zio-prelude/"},"zio-prelude"),"."),(0,t.yg)("p",null,"The following example:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},"kinesis.describeStreamConsumer(\n  DescribeStreamConsumerRequest(\n    consumerName = Some(consumerName),\n    streamARN = Some(streamDescription.streamDescriptionValue.streamARNValue)\n  )\n)\n")),(0,t.yg)("p",null,"becomes"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},"Kinesis.describeStreamConsumer(\n  DescribeStreamConsumerRequest(\n    consumerName = consumerName,\n    streamARN = streamDescription.streamDescription.streamARN\n  )\n)\n")),(0,t.yg)("h2",{id:"newtypes"},"Newtypes"),(0,t.yg)("p",null,"Previously zio-aws generated simple Scala type aliases for primitive types in the AWS SDKs. For example the ",(0,t.yg)("inlineCode",{parentName:"p"},"TableName")," type in ",(0,t.yg)("inlineCode",{parentName:"p"},"zio-aws-dynamodb")," was just a type alias for ",(0,t.yg)("inlineCode",{parentName:"p"},"String"),":"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},"package io.github.vigoo.zioaws.dynamodb.model\n\npackage object primitives {\n  type TableName = String\n}\n")),(0,t.yg)("p",null,"The new version uses ",(0,t.yg)("a",{parentName:"p",href:"https://zio.github.io/zio-prelude/docs/newtypes/"},"zio-prelude's newtype wrappers")," to provide better type safety:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},"package zio.aws.dynamodb.model\n\npackage object primitives {\n  object TableName extends Subtype[String]\n  type TableName = TableName.Type\n}\n")),(0,t.yg)("p",null,"In practice this means that we have to explicitly wrap these primitive values, for example instead of:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},'elasticbeanstalk.describeApplications(\n  DescribeApplicationsRequest(applicationNames = Some(List("my-service")))\n)\n')),(0,t.yg)("p",null,"now we have to write"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},'ElasticBeanstalk.describeApplications(\n  DescribeApplicationsRequest(applicationNames = List(ApplicationName("my-service")))\n)\n')),(0,t.yg)("p",null,"and if we need to convert them to the underlying primitive type we need to call ",(0,t.yg)("inlineCode",{parentName:"p"},"unwrap"),":"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},"ResourceId.unwrap(id)\n")),(0,t.yg)("h2",{id:"aspects"},"Aspects"),(0,t.yg)("p",null,"zio-aws introduced ",(0,t.yg)("inlineCode",{parentName:"p"},"AwsCallAspect")," soon after Adam Fraser's ",(0,t.yg)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=gcqWdNwNEPg&t=2s"},"talk")," but it was a custom implementation, defined as:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},"trait AwsCallAspect[-R] { self =>\n  def apply[R1 <: R, A](\n    f: ZIO[R1, AwsError, Described[A]]\n  ): ZIO[R1, AwsError, Described[A]]\n\n  // ...\n}\n")),(0,t.yg)("p",null,"These aspects can be applied to whole zio-aws service layers to add logging, metrics, retries etc for every AWS Java SDK call."),(0,t.yg)("p",null,"The ZIO 2.0.0 version is now using ZIO's built-in aspect support as a base:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},"type AwsCallAspect[-R] =\n  ZIOAspect[Nothing, R, AwsError, AwsError, Nothing, Described[_]]\n")),(0,t.yg)("h3",{id:"new-built-in-aspects"},"New built-in aspects"),(0,t.yg)("p",null,"With ZIO 2 we have logging and metrics support built-in, so zio-aws now provides ready to use aspects for logging and monitoring AWS calls:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},"val callLogging: AwsCallAspect[Any]\ndef callDuration(prefix: String, boundaries: MetricKeyType.Histogram.Boundaries): AwsCallAspect[Any]\n")),(0,t.yg)("h3",{id:"changes-in-defining-aspects"},"Changes in defining aspects"),(0,t.yg)("p",null,"The following example aspect uses ",(0,t.yg)("inlineCode",{parentName:"p"},"rezilience")," to add circuit breaking for an AWS service:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},"def circuitBreaking(cb: CircuitBreaker[AwsError]): AwsCallAspect[Any] =\n  new AwsCallAspect[Any] {\n    override final def apply[R1 <: Any, A](\n      f: ZIO[R1, AwsError, Described[A]]\n    ): ZIO[R1, AwsError, Described[A]] =\n      cb(f).mapError(policyError =>\n        AwsError.fromThrowable(policyError.toException)\n      )\n  }\n")),(0,t.yg)("p",null,"because of the changed base type for ",(0,t.yg)("inlineCode",{parentName:"p"},"AwsCallAspect")," with the new version the same aspect is defined like this:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},"def circuitBreaking(cb: CircuitBreaker[AwsError]): AwsCallAspect[Any] =\n  new AwsCallAspect[Any] {\n    override final def apply[R, E >: AwsError <: AwsError, A <: Described[_]](\n      f: ZIO[R, E, A]\n    )(implicit trace: Trace): ZIO[R, E, A] =\n      cb(f).mapError(policyError =>\n        AwsError.fromThrowable(policyError.toException)\n      )\n  }\n")),(0,t.yg)("p",null,"The main differences:"),(0,t.yg)("ul",null,(0,t.yg)("li",{parentName:"ul"},"requiring the implicit ",(0,t.yg)("inlineCode",{parentName:"li"},"Trace")," "),(0,t.yg)("li",{parentName:"ul"},"the constraints on the error and result types are now expressed as type bounds because the ZIO aspect is more generic")),(0,t.yg)("h2",{id:"new-config-library"},"New config library"),(0,t.yg)("p",null,"The 3.x series of zio-aws was using ",(0,t.yg)("inlineCode",{parentName:"p"},"zio-config 1.x"),". The recently released 4.x series was using ",(0,t.yg)("inlineCode",{parentName:"p"},"zio-config 2.x")," which is the ZIO 1 version of the config library's new API; The ZIO 2 version of zio-aws uses ",(0,t.yg)("inlineCode",{parentName:"p"},"zio-config 3.x")," which is the same new config API but for ZIO 2."),(0,t.yg)("p",null,"This means that coming from zio-aws 3.x requires upgrading to the new config API. For more information about the changes in zio-config, ",(0,t.yg)("a",{parentName:"p",href:"https://github.com/zio/zio-config/releases/tag/v2.0.0-RC1"},"see it's release notes"),"."))}m.isMDXComponent=!0}}]);