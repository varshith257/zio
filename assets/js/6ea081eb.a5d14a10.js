"use strict";(self.webpackChunkzio_site=self.webpackChunkzio_site||[]).push([[30247],{15680:(e,n,o)=>{o.d(n,{xA:()=>p,yg:()=>c});var r=o(96540);function g(e,n,o){return n in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}function l(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),o.push.apply(o,r)}return o}function i(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?l(Object(o),!0).forEach((function(n){g(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):l(Object(o)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(o,n))}))}return e}function t(e,n){if(null==e)return{};var o,r,g=function(e,n){if(null==e)return{};var o,r,g={},l=Object.keys(e);for(r=0;r<l.length;r++)o=l[r],n.indexOf(o)>=0||(g[o]=e[o]);return g}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)o=l[r],n.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(g[o]=e[o])}return g}var a=r.createContext({}),s=function(e){var n=r.useContext(a),o=n;return e&&(o="function"==typeof e?e(n):i(i({},n),e)),o},p=function(e){var n=s(e.components);return r.createElement(a.Provider,{value:n},e.children)},m="mdxType",f={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var o=e.components,g=e.mdxType,l=e.originalType,a=e.parentName,p=t(e,["components","mdxType","originalType","parentName"]),m=s(o),d=g,c=m["".concat(a,".").concat(d)]||m[d]||f[d]||l;return o?r.createElement(c,i(i({ref:n},p),{},{components:o})):r.createElement(c,i({ref:n},p))}));function c(e,n){var o=arguments,g=n&&n.mdxType;if("string"==typeof e||g){var l=o.length,i=new Array(l);i[0]=d;var t={};for(var a in n)hasOwnProperty.call(n,a)&&(t[a]=n[a]);t.originalType=e,t[m]="string"==typeof e?e:g,i[1]=t;for(var s=2;s<l;s++)i[s]=o[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,o)}d.displayName="MDXCreateElement"},81146:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>f,frontMatter:()=>l,metadata:()=>t,toc:()=>s});var r=o(58168),g=(o(96540),o(15680));const l={id:"slf4j2-bridge",title:"SLF4J v2 bridge"},i=void 0,t={unversionedId:"zio-logging/slf4j2-bridge",id:"zio-logging/slf4j2-bridge",title:"SLF4J v2 bridge",description:"It is possible to use zio-logging for SLF4J loggers, usually third-party non-ZIO libraries. To do so, import  the zio-logging-slf4j2-bridge module for SLF4J v2 (using JDK9+ module system (JPMS))",source:"@site/docs/zio-logging/slf4j2-bridge.md",sourceDirName:"zio-logging",slug:"/zio-logging/slf4j2-bridge",permalink:"/zio-logging/slf4j2-bridge",draft:!1,editUrl:"https://github.com/zio/zio/edit/series/2.x/docs/zio-logging/slf4j2-bridge.md",tags:[],version:"current",frontMatter:{id:"slf4j2-bridge",title:"SLF4J v2 bridge"},sidebar:"ecosystem-sidebar",previous:{title:"SLF4J v1",permalink:"/zio-logging/slf4j1"},next:{title:"SLF4J v1 bridge",permalink:"/zio-logging/slf4j1-bridge"}},a={},s=[{value:"Examples",id:"examples",level:2},{value:"SLF4J bridge with JSON console logger",id:"slf4j-bridge-with-json-console-logger",level:3}],p={toc:s},m="wrapper";function f(e){let{components:n,...o}=e;return(0,g.yg)(m,(0,r.A)({},p,o,{components:n,mdxType:"MDXLayout"}),(0,g.yg)("p",null,"It is possible to use ",(0,g.yg)("inlineCode",{parentName:"p"},"zio-logging")," for SLF4J loggers, usually third-party non-ZIO libraries. To do so, import  the ",(0,g.yg)("inlineCode",{parentName:"p"},"zio-logging-slf4j2-bridge")," module for ",(0,g.yg)("a",{parentName:"p",href:"https://www.slf4j.org/faq.html#changesInVersion200"},"SLF4J v2")," (using JDK9+ module system (",(0,g.yg)("a",{parentName:"p",href:"http://openjdk.java.net/projects/jigsaw/spec/"},"JPMS"),"))"),(0,g.yg)("pre",null,(0,g.yg)("code",{parentName:"pre",className:"language-scala"},'libraryDependencies += "dev.zio" %% "zio-logging-slf4j2-bridge" % "2.3.2"\n')),(0,g.yg)("p",null,"and use one of the ",(0,g.yg)("inlineCode",{parentName:"p"},"Slf4jBridge")," layers when setting up logging:"),(0,g.yg)("pre",null,(0,g.yg)("code",{parentName:"pre",className:"language-scala"},"import zio.logging.slf4j.Slf4jBridge\n\nprogram.provideCustom(Slf4jBridge.init())\n")),(0,g.yg)("p",null,(0,g.yg)("inlineCode",{parentName:"p"},"Slf4jBridge")," layers:"),(0,g.yg)("ul",null,(0,g.yg)("li",{parentName:"ul"},(0,g.yg)("inlineCode",{parentName:"li"},"Slf4jBridge.init(configPath: NonEmptyChunk[String] = logFilterConfigPath)")," - setup with ",(0,g.yg)("inlineCode",{parentName:"li"},"LogFilter")," from ",(0,g.yg)("a",{parentName:"li",href:"/zio-logging/log-filter#configuration"},"filter configuration"),", default configuration path: ",(0,g.yg)("inlineCode",{parentName:"li"},"logger.filter"),", default ",(0,g.yg)("inlineCode",{parentName:"li"},"LogLevel")," is ",(0,g.yg)("inlineCode",{parentName:"li"},"INFO")),(0,g.yg)("li",{parentName:"ul"},(0,g.yg)("inlineCode",{parentName:"li"},"Slf4jBridge.init(filter: LogFilter[Any])")," - setup with given ",(0,g.yg)("inlineCode",{parentName:"li"},"LogFilter")),(0,g.yg)("li",{parentName:"ul"},(0,g.yg)("inlineCode",{parentName:"li"},"Slf4jBridge.initialize")," - setup without filtering")),(0,g.yg)("p",null,"SLF4J v2 ",(0,g.yg)("a",{parentName:"p",href:"https://www.slf4j.org/manual.html#fluent"},"key-value pairs")," are propagated like ZIO log annotations."),(0,g.yg)("p",null,"Need for log filtering in slf4j bridge: libraries with slf4j loggers, may have conditional logic for logging,\nwhich using functions like ",(0,g.yg)("a",{parentName:"p",href:"https://github.com/qos-ch/slf4j/blob/master/slf4j-api/src/main/java/org/slf4j/Logger.java#L170"},"org.slf4j.Logger.isTraceEnabled()"),".\nlogging parts may contain message and log parameters construction, which may be expensive and degrade performance of application."),(0,g.yg)("br",null),(0,g.yg)("p",null,"SLF4J logger name is stored in log annotation with key ",(0,g.yg)("inlineCode",{parentName:"p"},"logger_name")," (",(0,g.yg)("inlineCode",{parentName:"p"},"zio.logging.loggerNameAnnotationKey"),"), following log format"),(0,g.yg)("pre",null,(0,g.yg)("code",{parentName:"pre",className:"language-scala"},"import zio.logging.slf4j.Slf4jBridge\nimport zio.logging.LoggerNameExtractor\n\nval loggerName = LoggerNameExtractor.loggerNameAnnotationOrTrace\nval loggerNameFormat = loggerName.toLogFormat()\n")),(0,g.yg)("p",null,"may be used to get logger name from log annotation or ZIO Trace. "),(0,g.yg)("p",null,"This logger name extractor is used by default in log filter, which applying log filtering by defined logger name and level:"),(0,g.yg)("pre",null,(0,g.yg)("code",{parentName:"pre",className:"language-scala"},'val logFilterConfig = LogFilter.LogLevelByNameConfig(\n  LogLevel.Info,\n  "zio.logging.slf4j" -> LogLevel.Debug,\n  "SLF4J-LOGGER"      -> LogLevel.Warning\n)\n\nval logFilter: LogFilter[String] = logFilterConfig.toFilter\n')),(0,g.yg)("br",null),(0,g.yg)("p",null,"SLF4J bridge with custom logger can be setup:"),(0,g.yg)("pre",null,(0,g.yg)("code",{parentName:"pre",className:"language-scala"},"import zio.logging.slf4j.Slf4jBridge\nimport zio.logging.consoleJsonLogger\n\nval logger = Runtime.removeDefaultLoggers >>> consoleJsonLogger() >+> Slf4jBridge.init()\n")),(0,g.yg)("br",null),(0,g.yg)("p",null,(0,g.yg)("strong",{parentName:"p"},"NOTE:")," You should either use ",(0,g.yg)("inlineCode",{parentName:"p"},"zio-logging-slf4j")," to send all ZIO logs to an SLF4j provider (such as logback, log4j etc) OR ",(0,g.yg)("inlineCode",{parentName:"p"},"zio-logging-slf4j-bridge")," to send all SLF4j logs to\nZIO logging. Enabling both causes circular logging and makes no sense."),(0,g.yg)("h2",{id:"examples"},"Examples"),(0,g.yg)("p",null,"You can find the source code ",(0,g.yg)("a",{parentName:"p",href:"https://github.com/zio/zio-logging/tree/master/examples"},"here")),(0,g.yg)("h3",{id:"slf4j-bridge-with-json-console-logger"},"SLF4J bridge with JSON console logger"),(0,g.yg)("pre",null,(0,g.yg)("code",{parentName:"pre",className:"language-scala"},'package zio.logging.example\n\nimport zio.logging.{ ConsoleLoggerConfig, LogAnnotation, LogFilter, LogFormat, LoggerNameExtractor, consoleJsonLogger }\nimport zio.{ ExitCode, LogLevel, Runtime, Scope, ZIO, ZIOAppArgs, ZIOAppDefault, ZLayer }\n\nimport java.util.UUID\n\nobject Slf4jBridgeExampleApp extends ZIOAppDefault {\n\n  private val slf4jLogger = org.slf4j.LoggerFactory.getLogger("SLF4J-LOGGER")\n\n  private val logFilterConfig = LogFilter.LogLevelByNameConfig(\n    LogLevel.Info,\n    "zio.logging.slf4j" -> LogLevel.Debug,\n    "SLF4J-LOGGER"      -> LogLevel.Warning\n  )\n\n  private val logFormat = LogFormat.label(\n    "name",\n    LoggerNameExtractor.loggerNameAnnotationOrTrace.toLogFormat()\n  ) + LogFormat.allAnnotations(Set(zio.logging.loggerNameAnnotationKey)) + LogFormat.default\n\n  private val loggerConfig = ConsoleLoggerConfig(logFormat, logFilterConfig)\n\n  override val bootstrap: ZLayer[ZIOAppArgs, Any, Any] =\n    Runtime.removeDefaultLoggers >>> consoleJsonLogger(loggerConfig) >+> Slf4jBridge.init(loggerConfig.toFilter)\n\n  private val uuids = List.fill(2)(UUID.randomUUID())\n\n  override def run: ZIO[Scope, Any, ExitCode] =\n    for {\n      _ <- ZIO.logInfo("Start")\n      _ <- ZIO.foreachPar(uuids) { u =>\n        ZIO.succeed(slf4jLogger.info("Test {}!", "INFO")) *> ZIO.succeed(\n          slf4jLogger.atWarn().addArgument("WARNING").log("Test {}!")\n        ) @@ LogAnnotation.UserId(\n          u.toString\n        )\n      } @@ LogAnnotation.TraceId(UUID.randomUUID())\n      _ <- ZIO.logDebug("Done")\n    } yield ExitCode.success\n\n}\n')),(0,g.yg)("p",null,"Expected Console Output:"),(0,g.yg)("pre",null,(0,g.yg)("code",{parentName:"pre"},'{"name":"zio.logging.example.Slf4jBridgeExampleApp","timestamp":"2024-05-28T08:05:48.056029+02:00","level":"INFO","thread":"zio-fiber-735317063","message":"Start"}\n{"name":"SLF4J-LOGGER","trace_id":"416f3886-717c-4359-9f6e-c260e49fd158","user_id":"580376aa-f851-43a2-8b17-9456ce005e93","timestamp":"2024-05-28T08:05:48.065133+02:00","level":"WARN","thread":"zio-fiber-1749629949","message":"Test WARNING!"}\n{"name":"SLF4J-LOGGER","trace_id":"416f3886-717c-4359-9f6e-c260e49fd158","user_id":"76d49e0d-7c28-47fd-b5a1-d05afb487cfe","timestamp":"2024-05-28T08:05:48.065174+02:00","level":"WARN","thread":"zio-fiber-697454589","message":"Test WARNING!"}\n{"name":"zio.logging.example.Slf4jBridgeExampleApp","timestamp":"2024-05-28T08:05:48.068127+02:00","level":"DEBUG","thread":"zio-fiber-735317063","message":"Done"}\n')))}f.isMDXComponent=!0}}]);